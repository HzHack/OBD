<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0f172a">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3209/3209995.png">

    <title>PRO MECHANIC | AI SYSTEM</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #ff6b00;      
            --accent: #6366f1;       
            --success: #10b981;      
            --bg-dark: #0f172a;      
            --glass: rgba(30, 41, 59, 0.75);
            --border: rgba(255, 255, 255, 0.1);
            --text: #f8fafc;
            --insta-grad: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Cairo', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text);
            background-image: 
                linear-gradient(rgba(15, 23, 42, 0.96), rgba(15, 23, 42, 0.96)),
                url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M20 20h20v20H20zM0 0h20v20H0z' fill='%23ff6b00' fill-opacity='0.03' fill-rule='evenodd'/%3E%3C/svg%3E");
            min-height: 100vh;
            padding-bottom: 80px;
            scroll-behavior: smooth;
        }

        header { text-align: center; padding: 30px 20px; }
        h1 {
            font-size: 2.5rem; font-weight: 900; margin: 0;
            background: linear-gradient(to right, #fff, #94a3b8);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            text-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }
        .status-badge {
            background: rgba(16, 185, 129, 0.1); color: var(--success);
            padding: 5px 15px; border-radius: 20px; font-size: 0.8rem; font-weight: bold;
            border: 1px solid rgba(16, 185, 129, 0.2); margin-top: 10px; display: inline-block;
        }

        .container { max-width: 900px; margin: 0 auto; padding: 0 15px; }

        .card {
            background: var(--glass);
            backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
            border: 1px solid var(--border);
            border-radius: 24px; padding: 25px; margin-bottom: 25px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
            position: relative; overflow: hidden;
        }
        .card::before {
            content:''; position: absolute; top:0; left:0; width:100%; height:4px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
        }

        .section-head { display: flex; align-items: center; gap: 12px; margin-bottom: 20px; }
        .section-head h2 { font-size: 1.3rem; color: #fff; margin: 0; }
        .icon-box { 
            width: 40px; height: 40px; background: rgba(255,255,255,0.05); 
            border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem;
        }

        .input-group { margin-bottom: 15px; }
        input, select, textarea {
            width: 100%; padding: 18px; 
            background: rgba(10, 15, 30, 0.6);
            border: 2px solid var(--border); border-radius: 16px;
            color: #fff; font-family: 'Cairo'; font-size: 1.1rem; transition: 0.3s;
        }
        input:focus, select:focus, textarea:focus { border-color: var(--primary); transform: translateY(-2px); }

        .btn-row { display: flex; gap: 12px; margin-top: 10px; }
        button {
            flex: 1; padding: 18px; border: none; border-radius: 16px;
            font-family: 'Cairo'; font-weight: 800; font-size: 1rem; cursor: pointer;
            transition: 0.2s; display: flex; justify-content: center; align-items: center; gap: 10px;
        }
        button:active { transform: scale(0.97); }
        .btn-scan { background: linear-gradient(135deg, var(--primary), #ea580c); color: #fff; box-shadow: 0 4px 20px rgba(255, 107, 0, 0.25); }
        .btn-ai { background: linear-gradient(135deg, var(--accent), #4f46e5); color: #fff; }
        .btn-ghost { background: rgba(255,255,255,0.08); color: #fff; }

        /* VIN & Notes */
        .vin-result { display: none; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 16px; margin-top: 15px; border: 1px dashed var(--border); }
        .vin-tag { display: inline-block; background: var(--accent); padding: 5px 10px; border-radius: 10px; font-size: 0.8rem; margin-right: 5px; }
        .notes-area { min-height: 150px; line-height: 1.6; font-size: 1rem; }

        /* Results */
        #resultCard { display: none; margin-top: 20px; animation: slideUp 0.5s ease; }
        .the-code { font-size: 3.5rem; font-weight: 900; color: var(--primary); line-height: 1; text-shadow: 0 0 30px rgba(255, 107, 0, 0.4); text-align: center; }
        
        /* AI Box Styles */
        .ai-box { 
            background: rgba(99, 102, 241, 0.08); border: 1px dashed var(--accent); 
            padding: 20px; border-radius: 16px; margin-top: 20px; display: none; position: relative;
        }
        /* AI Pulse Animation */
        .ai-active {
            border-color: var(--accent);
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.2);
        }
        .ai-loader {
            display: none; text-align: center; color: var(--accent); margin-top: 10px;
        }
        .radar-scan {
            width: 100%; height: 2px; background: linear-gradient(90deg, transparent, var(--accent), transparent);
            animation: radar 1.5s infinite;
        }
        
        /* Footer */
        footer { text-align: center; margin-top: 50px; border-top: 1px solid var(--border); padding-top: 30px; color: #64748b; }
        .social-container { display: flex; justify-content: center; gap: 15px; margin-top: 15px; flex-wrap: wrap; }
        .social-btn {
            display: flex; align-items: center; gap: 8px; padding: 10px 20px;
            border-radius: 50px; text-decoration: none; color: #fff; font-weight: bold; font-size: 0.9rem;
            transition: transform 0.3s;
        }
        .social-btn:hover { transform: translateY(-3px); }
        .insta { background: var(--insta-grad); }
        .snap { background: #FFFC00; color: #000; }
        .twitter { background: #1DA1F2; }

        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes radar { 0% { transform: translateX(-100%); opacity: 0; } 50% { opacity: 1; } 100% { transform: translateX(100%); opacity: 0; } }
        /* ØªØ£Ø«ÙŠØ± Ø§Ù„ÙƒØªØ§Ø¨Ø© */
        @keyframes blink { 50% { opacity: 0; } }
        .cursor { display: inline-block; width: 6px; height: 16px; background: var(--accent); animation: blink 1s infinite; vertical-align: middle; margin-right: 5px; }

    </style>
</head>
<body>

    <header>
        <h1>PRO MECHANIC</h1>
        <div id="dbStatus" class="status-badge">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…...</div>
    </header>

    <div class="container">

        <section class="card" id="diagnosticSection">
            <div class="section-head">
                <div class="icon-box">ğŸ§ </div>
                <h2>ÙØ­Øµ Ø§Ù„Ø£Ø¹Ø·Ø§Ù„ (OBD-II)</h2>
            </div>

            <div class="input-group">
                <select id="carBrand">
                    <option value="Generic">ğŸï¸ Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø© (Ø¹Ø§Ù…)</option>
                    <option value="Toyota">ğŸ‡¯ğŸ‡µ ØªÙˆÙŠÙˆØªØ§ / Ù„ÙƒØ²Ø³</option>
                    <option value="Nissan">ğŸ‡¯ğŸ‡µ Ù†ÙŠØ³Ø§Ù† / Ø¥Ù†ÙÙŠÙ†ÙŠØªÙŠ</option>
                    <option value="Hyundai">ğŸ‡°ğŸ‡· Ù‡ÙŠÙˆÙ†Ø¯Ø§ÙŠ / ÙƒÙŠØ§</option>
                    <option value="GM">ğŸ‡ºğŸ‡¸ Ø´ÙØ±ÙˆÙ„ÙŠÙ‡ / Ø¬Ù…Ø³</option>
                    <option value="Ford">ğŸ‡ºğŸ‡¸ ÙÙˆØ±Ø¯ / Ù„ÙŠÙ†ÙƒÙˆÙ„Ù†</option>
                    <option value="German">ğŸ‡©ğŸ‡ª Ù…Ø±Ø³ÙŠØ¯Ø³ / Ø¨ÙŠ Ø§Ù…</option>
                </select>
            </div>

            <div class="input-group">
                <input type="text" id="codeInput" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø¹Ø·Ù„ (Ù…Ø«Ø§Ù„: P0300)">
            </div>

            <div class="btn-row">
                <button class="btn-scan" onclick="performScan(false)">ğŸ” ÙØ­Øµ</button>
                <button class="btn-ai" onclick="performScan(true)">ğŸ¤– ØªØ­Ù„ÙŠÙ„ AI</button>
            </div>

            <div style="margin-top:15px; overflow-x:auto; white-space:nowrap; padding-bottom:5px;" id="historyList"></div>

            <div id="aiLoading" class="ai-loader">
                <div>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ...</div>
                <div class="radar-scan"></div>
            </div>

            <div id="resultCard">
                <div class="the-code" id="resCode">P0000</div>
                <div style="text-align:center; color:#94a3b8; margin-bottom:15px;" id="resSystem">Unknown System</div>

                <div style="background:rgba(0,0,0,0.2); border-radius:12px; padding:15px;">
                    <div style="margin-bottom:10px;"><span style="color:#94a3b8;">Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:</span> <strong id="resMean" style="color:#fff; float:left;">-</strong></div>
                    <div style="clear:both; border-top:1px solid rgba(255,255,255,0.1); margin:10px 0;"></div>
                    <div><span style="color:#94a3b8;">Ø§Ù„Ø­Ù„:</span> <strong id="resFix" style="color:var(--success); float:left;">-</strong></div>
                </div>

                <div id="aiPanel" class="ai-box">
                    <strong style="color:var(--accent);">ğŸ’¡ Ø§Ø³ØªØ´Ø§Ø±Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ:</strong>
                    <p id="aiText" style="margin-top:8px; line-height:1.6; color:#e2e8f0; font-size:0.95rem; min-height:40px;"></p>
                </div>

                <a href="#" id="waLink" target="_blank" style="display:block; text-align:center; background:#25D366; color:#fff; padding:15px; border-radius:16px; margin-top:20px; text-decoration:none; font-weight:bold;">ğŸ“¤ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„ØªÙ‚Ø±ÙŠØ± (ÙˆØ§ØªØ³Ø§Ø¨)</a>
            </div>
        </section>

        <section class="card">
            <div class="section-head">
                <div class="icon-box">ğŸš—</div>
                <h2>ÙÙƒ Ø±Ù‚Ù… Ø§Ù„Ù‡ÙŠÙƒÙ„ (VIN)</h2>
            </div>
            <div class="input-group">
                <input type="text" id="vinInput" maxlength="17" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø´Ø§ØµÙŠ (17 Ø®Ø§Ù†Ø©)" style="letter-spacing: 2px; text-transform: uppercase;">
            </div>
            <button class="btn-ghost" onclick="decodeVIN()" style="width: 100%;">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø±Ù‚Ù…</button>
            <div id="vinResult" class="vin-result">
                <div style="margin-bottom: 5px;"><span class="vin-tag">Ø§Ù„Ø¨Ù„Ø¯</span> <strong id="vinCountry">-</strong></div>
                <div><span class="vin-tag">Ø§Ù„Ø³Ù†Ø©</span> <strong id="vinYear">-</strong></div>
            </div>
        </section>

        <section class="card">
            <div class="section-head">
                <div class="icon-box">âš–ï¸</div>
                <h2>Ù…Ø­ÙˆÙ„Ø§Øª Ø§Ù„ÙˆØ­Ø¯Ø§Øª</h2>
            </div>
            <h3 style="color:var(--primary); font-size:1rem; margin-bottom:10px;">ğŸ”§ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¹Ø²Ù…</h3>
            <div class="converter-grid">
                <div><span class="unit-label">Nm</span><input type="number" id="nmInput" class="conv-input" placeholder="0" oninput="convertTorque('nm')"></div>
                <div><span class="unit-label">ft-lb</span><input type="number" id="ftlbInput" class="conv-input" placeholder="0" oninput="convertTorque('ftlb')"></div>
            </div>
            <h3 style="color:var(--primary); font-size:1rem; margin-bottom:10px; border-top:1px solid var(--border); padding-top:10px;">ğŸ’¨ Ø¶ØºØ· Ø§Ù„Ù‡ÙˆØ§Ø¡</h3>
            <div class="converter-grid">
                <div><span class="unit-label">PSI</span><input type="number" id="psiInput" class="conv-input" placeholder="0" oninput="convertPressure('psi')"></div>
                <div><span class="unit-label">Bar</span><input type="number" id="barInput" class="conv-input" placeholder="0" oninput="convertPressure('bar')"></div>
            </div>
        </section>

        <section class="card">
            <div class="section-head">
                <div class="icon-box">ğŸ“</div>
                <h2>Ù…ÙÙƒØ±Ø© Ø§Ù„Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠ</h2>
            </div>
            <textarea id="myNotes" class="notes-area" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ù‡Ù†Ø§..." oninput="saveNotes()"></textarea>
            <div style="text-align:left; font-size:0.8rem; color:var(--success); margin-top:5px;">âœ… ÙŠØªÙ… Ø§Ù„Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</div>
        </section>

        <section class="card" id="toolsSection">
            <div class="section-head">
                <div class="icon-box">ğŸ§®</div>
                <h2>Ø£Ø¯ÙˆØ§Øª & Ø£ÙƒÙˆØ§Ø¯</h2>
            </div>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:20px;">
                <button class="btn-ghost" onclick="showAllCodes()">ğŸ“š Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯</button>
                
                <div style="background:rgba(255,255,255,0.05); padding:10px; border-radius:12px; text-align:center;">
                    <div style="font-size:0.8rem; color:var(--accent);">Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù…ÙƒÙŠÙ†Ø©</div>
                    <div style="display:flex; gap:2px; margin-top:5px;">
                        <input id="boreInput" placeholder="B" style="padding:5px; font-size:0.8rem; width:30%;">
                        <input id="strokeInput" placeholder="S" style="padding:5px; font-size:0.8rem; width:30%;">
                        <input id="cylInput" placeholder="C" style="padding:5px; font-size:0.8rem; width:30%;">
                    </div>
                    <button onclick="calcCC()" style="background:var(--primary); width:100%; padding:5px; margin-top:5px; border-radius:5px; border:none; color:white;">Ø§Ø­Ø³Ø¨ CC</button>
                    <div id="ccDisplay" style="color:var(--success); font-weight:bold; font-size:0.9rem; margin-top:5px;"></div>
                </div>
            </div>
            
            <div id="tableContainer" style="overflow-x:auto; max-height:250px; scroll-behavior:smooth;">
                <table style="width:100%; text-align:right; border-collapse:collapse;">
                    <thead><tr style="color:var(--primary); position:sticky; top:0; background:var(--glass);"><th style="padding:10px;">Ø§Ù„ÙƒÙˆØ¯</th><th>Ø§Ù„ÙˆØµÙ</th></tr></thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
        </section>

    </div>

    <footer>
        <div style="font-weight:bold; font-size:1.1rem; color:#fff; margin-bottom:10px;">
            ØªÙ… Ø§Ù„ØªØ·ÙˆÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø©: <span style="color:var(--primary);">Ø§Ø¨Ùˆ Ø¹Ø³Ø§Ù Hz</span>
        </div>
        
        <div class="social-container">
            <a href="https://instagram.com/sww_p" target="_blank" class="social-btn insta">ğŸ“· Instagram</a>
            <a href="https://snapchat.com/add/sww_p" target="_blank" class="social-btn snap">ğŸ‘» Snapchat</a>
            <a href="https://twitter.com/sww_p" target="_blank" class="social-btn twitter">ğŸ¦ Twitter</a>
        </div>
        
        <p style="margin-top:20px; font-size:0.8rem;">Ù†Ø³Ø®Ø© S23 Ultra Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© Â© 2026</p>
    </footer>

    <script>
        /* =========================================
           JAVASCRIPT LOGIC
           ========================================= */
        let db = [];
        function add(c, m, f, sys, b) { if(!db.some(x=>x.c===c)) db.push({c, m, f, sys, b}); }

        // Data
        add("P0101", "Ø£Ø¯Ø§Ø¡ Ø­Ø³Ø§Ø³ MAF", "ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø­Ø³Ø§Ø³", "Air", "All");
        add("P0171", "Ø®Ù„ÙŠØ· ÙÙ‚ÙŠØ± (Lean)", "ÙØ­Øµ ØªÙ‡Ø±ÙŠØ¨ Ù‡ÙˆØ§Ø¡", "Fuel", "All");
        add("P0300", "ÙÙ‚Ø¯ Ø¥Ø´Ø¹Ø§Ù„ (Misfire)", "Ø¨ÙˆØ§Ø¬ÙŠ / ÙƒÙˆÙŠÙ„Ø§Øª", "Ignition", "All");
        add("P0420", "ÙƒÙØ§Ø¡Ø© Ø¯Ø¨Ø© Ø§Ù„ØªÙ„ÙˆØ«", "ÙØ­Øµ Ø§Ù„Ø¯Ø¨Ø©", "Exhaust", "All");
        add("P0442", "ØªØ³Ø±ÙŠØ¨ ØªØ¨Ø®ÙŠØ± Ø¨Ø³ÙŠØ·", "ØªØºÙŠÙŠØ± ØºØ·Ø§Ø¡ Ø§Ù„Ø¨Ù†Ø²ÙŠÙ†", "EVAP", "All");
        add("P0700", "Ø¹Ø·Ù„ Ù‚ÙŠØ±", "ÙØ­Øµ ÙƒÙ…Ø¨ÙŠÙˆØªØ± Ù‚ÙŠØ±", "Trans", "All");

        for(let i=100; i<999; i++) {
            let c="P0"+i;
            if(!db.some(x=>x.c===c)) {
                let sys="General";
                if(i<200) sys="Fuel/Air"; else if(i<300) sys="Injection"; else if(i<400) sys="Ignition"; 
                else if(i<500) sys="Emission"; else if(i<600) sys="Speed"; else if(i<700) sys="ECU"; else sys="Trans";
                add(c, "Ø¹Ø·Ù„ ÙÙŠ Ù†Ø¸Ø§Ù… "+sys, "ÙØ­Øµ Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©", sys, "Generic");
            }
        }
        document.getElementById('dbStatus').innerText = "Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø²: "+db.length+" ÙƒÙˆØ¯";

        // --- SCANNING LOGIC ---
        function performScan(isAI) {
            let input = document.getElementById('codeInput').value.toUpperCase().trim();
            let brand = document.getElementById('carBrand').value;
            let card = document.getElementById('resultCard');
            let loader = document.getElementById('aiLoading');
            
            if(!input) { alert("Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯!"); return; }
            
            card.style.display = "none";
            document.getElementById('aiPanel').style.display = "none";
            document.getElementById('aiText').innerHTML = ""; // Reset text

            if(isAI) {
                // Show Loader
                loader.style.display = "block";
                document.getElementById('dbStatus').innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„...";
                
                // Simulate delay
                setTimeout(() => { 
                    loader.style.display = "none";
                    showResult(input, brand, true); 
                    document.getElementById('dbStatus').innerText = "ØªÙ… Ø§Ù„ØªØ­Ù„ÙŠÙ„"; 
                }, 2000);
            } else {
                showResult(input, brand, false);
            }
        }

        function showResult(code, brand, isAI) {
            let item = db.find(x => x.c === code);
            let displayBrand = brand === "Generic" ? (item ? item.sys : "System") : brand;

            document.getElementById('resultCard').style.display = "block";
            document.getElementById('resCode').innerText = code;
            document.getElementById('resSystem').innerText = displayBrand + " System";

            // History
            let hist = document.getElementById('historyList');
            let chip = document.createElement('span');
            chip.style.cssText = "background:rgba(255,255,255,0.1); padding:5px 15px; border-radius:20px; margin-right:5px; color:#ccc; cursor:pointer; display:inline-block;";
            chip.innerText = code;
            chip.onclick = () => { loadCodeFromClick(code); };
            hist.prepend(chip);

            if(item) {
                document.getElementById('resMean').innerText = item.m;
                document.getElementById('resFix').innerText = item.f;
                let wa = `*ØªÙ‚Ø±ÙŠØ± ÙÙ†ÙŠ*\nğŸš˜ ${brand}\nâš ï¸ ${code}\nğŸ› ï¸ ${item.m}\nğŸ”§ ${item.f}`;
                document.getElementById('waLink').href = `https://wa.me/?text=${encodeURIComponent(wa)}`;
            } else {
                document.getElementById('resMean').innerText = "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
                document.getElementById('resFix').innerText = "ÙØ­Øµ Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…ØµÙ†Ø¹";
            }

            if(isAI) {
                let aiPanel = document.getElementById('aiPanel');
                aiPanel.style.display = "block";
                aiPanel.classList.add('ai-active'); // Add glow
                
                let textToType = `ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø°ÙƒØ§Ø¡ Ù„Ù„ÙƒÙˆØ¯ ${code} ÙÙŠ Ø³ÙŠØ§Ø±Ø© (${brand}):\n`;
                if(code.startsWith("P03")) textToType += "ØªÙ… Ø±ØµØ¯ Ù…Ø´ÙƒÙ„Ø© Ø¥Ø´Ø¹Ø§Ù„. ÙŠÙˆØµÙ‰ Ø¨ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙƒÙˆÙŠÙ„Ø§Øª (Swapping) Ù„ØªØ­Ø¯ÙŠØ¯ Ù…ØµØ¯Ø± Ø§Ù„Ø¹Ø·Ù„.";
                else if(code.startsWith("P017")) textToType += "Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø®Ù„ÙŠØ· Ø§Ù„ÙˆÙ‚ÙˆØ¯. ØºØ§Ù„Ø¨Ø§Ù‹ Ø¨Ø³Ø¨Ø¨ ØªÙ‡Ø±ÙŠØ¨ Ù‡ÙˆØ§Ø¡ (Vacuum Leak) ØºÙŠØ± Ù…Ø±Ø¦ÙŠ.";
                else if(code.startsWith("P07")) textToType += "Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ù‚ÙŠØ±. ÙŠØ±Ø¬Ù‰ ÙØ­Øµ Ø¬ÙˆØ¯Ø© Ø§Ù„Ø²ÙŠØª Ù‚Ø¨Ù„ Ø£ÙŠ Ø¥Ø¬Ø±Ø§Ø¡.";
                else textToType += "Ø§Ù„Ø¹Ø·Ù„ ØºØ§Ù„Ø¨Ø§Ù‹ ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„ÙÙŠÙˆØ²Ø§Øª ÙˆØ§Ù„ØªÙˆØµÙŠÙ„Ø§Øª Ù‚Ø¨Ù„ Ø§Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„.";

                // ØªØ´ØºÙŠÙ„ ØªØ£Ø«ÙŠØ± Ø§Ù„ÙƒØªØ§Ø¨Ø©
                typeWriterEffect(textToType, 'aiText');
            }
        }

        // --- Typewriter Effect ---
        function typeWriterEffect(text, elementId) {
            let i = 0;
            let speed = 30; // Ø³Ø±Ø¹Ø© Ø§Ù„ÙƒØªØ§Ø¨Ø©
            let elem = document.getElementById(elementId);
            elem.innerHTML = "<span class='cursor'></span>"; // Add cursor
            
            function type() {
                if (i < text.length) {
                    elem.innerHTML = text.substring(0, i+1) + "<span class='cursor'></span>";
                    i++;
                    setTimeout(type, speed);
                }
            }
            type();
        }

        function loadCodeFromClick(code) {
            document.getElementById('codeInput').value = code;
            document.getElementById('diagnosticSection').scrollIntoView({behavior: 'smooth'});
            performScan(false);
        }

        // --- FIX: Show All Codes Function ---
        function showAllCodes() {
            renderTable('all');
            // Ø§Ù„Ù†Ø²ÙˆÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù„Ù„Ø¬Ø¯ÙˆÙ„
            let tableSection = document.getElementById('tableContainer');
            tableSection.scrollIntoView({behavior: 'smooth'});
            // ÙˆÙ…ÙŠØ¶ Ø¨Ø³ÙŠØ· Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            tableSection.style.border = "2px solid var(--primary)";
            setTimeout(() => { tableSection.style.border = "none"; }, 1000);
        }

        // --- Other Features ---
        function saveNotes() { localStorage.setItem('mechanic_notes', document.getElementById('myNotes').value); }
        function decodeVIN() {
            let vin = document.getElementById('vinInput').value.toUpperCase();
            if(vin.length !== 17) { alert("Ø±Ù‚Ù… Ø§Ù„Ù‡ÙŠÙƒÙ„ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 17 Ø®Ø§Ù†Ø©"); return; }
            let country = "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
            let c1 = vin.charAt(0);
            if('145'.includes(c1)) country="Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª Ø§Ù„Ù…ØªØ­Ø¯Ø© (USA)";
            else if('J'.includes(c1)) country="Ø§Ù„ÙŠØ§Ø¨Ø§Ù† (Japan)";
            else if('K'.includes(c1)) country="ÙƒÙˆØ±ÙŠØ§ (Korea)";
            else if('W'.includes(c1)) country="Ø£Ù„Ù…Ø§Ù†ÙŠØ§ (Germany)";
            document.getElementById('vinResult').style.display = "block";
            document.getElementById('vinCountry').innerText = country;
            document.getElementById('vinYear').innerText = "20"+vin.charAt(9)+"X (ØªÙ‚Ø¯ÙŠØ±ÙŠ)";
        }

        function convertTorque(type) {
            let nm = document.getElementById('nmInput');
            let ft = document.getElementById('ftlbInput');
            if(type === 'nm') ft.value = (nm.value * 0.73756).toFixed(1);
            else nm.value = (ft.value * 1.3558).toFixed(1);
        }
        function convertPressure(type) {
            let psi = document.getElementById('psiInput');
            let bar = document.getElementById('barInput');
            if(type === 'psi') bar.value = (psi.value * 0.0689).toFixed(2);
            else psi.value = (bar.value * 14.5038).toFixed(1);
        }
        function calcCC() {
            let b = document.getElementById('boreInput').value;
            let s = document.getElementById('strokeInput').value;
            let c = document.getElementById('cylInput').value;
            if(b&&s&&c) document.getElementById('ccDisplay').innerText = ((Math.PI * Math.pow(b/2,2) * s * c)/1000).toFixed(0) + " CC";
        }

        function renderTable(f) {
            let tb = document.getElementById('tableBody'); tb.innerHTML="";
            let d = f==='all'?db:db.filter(x=>x.b===f||x.b==='All');
            d.slice(0,50).forEach(x=>{
                tb.innerHTML+=`<tr onclick="loadCodeFromClick('${x.c}')"><td style="padding:10px; border-bottom:1px solid #333; color:#ff6b00; font-weight:bold;">${x.c}</td><td style="padding:10px; border-bottom:1px solid #333; color:#ccc;">${x.m}</td></tr>`;
            });
        }

        window.onload = function() {
            renderTable('all');
            if(localStorage.getItem('mechanic_notes')) document.getElementById('myNotes').value = localStorage.getItem('mechanic_notes');
        };
    </script>
</body>
</html>
